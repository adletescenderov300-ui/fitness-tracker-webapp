<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí™ Fitness Pro - –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ç—Ä–µ–∫–µ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --tg-color-scheme: light;
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --bg: #f8fafc;
            --surface: #ffffff;
            --surface-dark: #f1f5f9;
            --text: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f172a;
                --surface: #1e293b;
                --surface-dark: #334155;
                --text: #f1f5f9;
                --text-secondary: #94a3b8;
                --border: #475569;
                --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            }
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            overflow: hidden;
        }

        /* Header */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px 20px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .header-content h1 {
            font-size: 1.5em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-subtitle {
            font-size: 0.9em;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Main content */
        .content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
            flex-direction: column;
            gap: 20px;
        }

        .section.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards */
        .card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--text);
        }

        .card-subtitle {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        /* Buttons */
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            white-space: nowrap;
            font-family: inherit;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--surface-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-icon {
            padding: 10px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        /* Navigation */
        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
            background: var(--surface);
            padding: 8px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .nav-tab {
            padding: 12px 8px;
            border: none;
            border-radius: var(--radius-sm);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow);
        }

        .nav-tab:hover:not(.active) {
            background: var(--surface-dark);
        }

        /* Forms */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }

        .form-label {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-input {
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 1em;
            background: var(--bg);
            color: var(--text);
            font-family: inherit;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .form-actions .btn {
            flex: 1;
        }

        /* Exercise items */
        .exercise-item {
            background: var(--bg);
            padding: 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .exercise-item:hover {
            background: var(--surface-dark);
        }

        .exercise-info {
            flex: 1;
        }

        .exercise-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .exercise-details {
            font-size: 0.85em;
            color: var(--text-secondary);
            display: flex;
            gap: 16px;
        }

        .exercise-actions {
            display: flex;
            gap: 8px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--surface) 0%, var(--surface-dark) 100%);
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 2em;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Workout programs */
        .programs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .program-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 16px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .program-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .program-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .program-title {
            font-weight: 700;
            font-size: 1.1em;
        }

        .program-exercises {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* History pagination */
        .history-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-top: 20px;
            padding: 16px;
            background: var(--surface);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .page-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: var(--bg);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        /* Empty states */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3.5em;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.2em;
            margin-bottom: 8px;
            color: var(--text);
        }

        /* Timer */
        .timer-container {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: var(--radius);
            padding: 24px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
        }

        .timer-display {
            font-size: 3em;
            font-weight: 800;
            margin: 10px 0;
            font-variant-numeric: tabular-nums;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
        }

        /* Messages */
        .message {
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        .message-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .message-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Footer */
        .app-footer {
            background: var(--surface);
            border-top: 1px solid var(--border);
            padding: 16px 20px;
            text-align: center;
            font-size: 0.85em;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .start-workout-btn {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .start-workout-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        }

        /* Responsive */
        @media (max-width: 640px) {
            .programs-grid,
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .timer-display {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <h1>üí™ Fitness Pro</h1>
                <button class="btn btn-icon btn-secondary" onclick="toggleTimer()" id="timerBtn">
                    ‚è±Ô∏è
                </button>
            </div>
            <div class="header-subtitle">
                <span>–¢–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä</span>
                <span id="currentDate"></span>
            </div>
        </header>

        <div class="content">
            <!-- Timer Section -->
            <div id="timer-section" class="section" style="display: none;">
                <div class="timer-container">
                    <h2>‚è±Ô∏è –¢–∞–π–º–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h2>
                    <div class="timer-display" id="timerDisplay">00:00</div>
                    <div class="timer-controls">
                        <button class="btn btn-success" onclick="startTimer()">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç</button>
                        <button class="btn btn-secondary" onclick="pauseTimer()">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
                        <button class="btn btn-danger" onclick="resetTimer()">‚èπÔ∏è –°–±—Ä–æ—Å</button>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="toggleTimer()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>

            <!-- Home Section -->
            <div id="home" class="section active">
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="showSection('quick-start')">
                        <span>üöÄ</span>
                        <span>–°—Ç–∞—Ä—Ç</span>
                    </button>
                    <button class="nav-tab" onclick="showSection('programs')">
                        <span>üìã</span>
                        <span>–ü—Ä–æ–≥—Ä–∞–º–º—ã</span>
                    </button>
                    <button class="nav-tab" onclick="showSection('history')">
                        <span>üìä</span>
                        <span>–ò—Å—Ç–æ—Ä–∏—è</span>
                    </button>
                    <button class="nav-tab" onclick="showSection('stats')">
                        <span>üìà</span>
                        <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    </button>
                </div>

                <div id="quick-start" class="section active">
                    <div class="card">
                        <h2 class="card-title">üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h2>
                        <p class="card-subtitle">–ù–∞—á–Ω–∏ –Ω–æ–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∏–ª–∏ –≤—ã–±–µ—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É</p>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="activeProgramCount">0</div>
                                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="workoutStreak">0</div>
                                <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="showSection('new-workout')">
                                <span>‚ûï</span>
                                <span>–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
                            </button>
                            <button class="btn btn-secondary" onclick="showSection('custom-workout')">
                                <span>‚úèÔ∏è</span>
                                <span>–°–≤–æ—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</span>
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">üéØ –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —Ü–µ–ª—å</h2>
                        <p class="card-subtitle" id="todayGoal">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º</p>
                        <div class="progress-bar" style="height: 8px; background: var(--border); border-radius: 4px; margin: 16px 0;">
                            <div id="goalProgress" style="height: 100%; background: var(--success); border-radius: 4px; width: 0%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Programs Section -->
                <div id="programs" class="section">
                    <h2 class="card-title">üìã –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2>
                    <p class="card-subtitle">–í—ã–±–µ—Ä–∏ –≥–æ—Ç–æ–≤—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –∏–ª–∏ —Å–æ–∑–¥–∞–π —Å–≤–æ—é</p>
                    
                    <div class="programs-grid" id="programsList">
                        <!-- Programs will be loaded here -->
                    </div>
                    
                    <button class="btn btn-primary" onclick="showSection('custom-workout')">
                        <span>‚ûï</span>
                        <span>–°–æ–∑–¥–∞—Ç—å —Å–≤–æ—é –ø—Ä–æ–≥—Ä–∞–º–º—É</span>
                    </button>
                </div>

                <!-- History Section -->
                <div id="history" class="section">
                    <h2 class="card-title">üìä –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ</label>
                            <select class="form-input" id="historyFilter" onchange="loadHistory()">
                                <option value="all">–í—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</option>
                                <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                                <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
                                <option value="year">–ó–∞ –≥–æ–¥</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                            <select class="form-input" id="historySort" onchange="loadHistory()">
                                <option value="newest">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                                <option value="oldest">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                                <option value="volume">–ü–æ –æ–±—ä—ë–º—É</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="historyContainer"></div>
                    <div id="historyPagination" class="history-pagination" style="display: none;">
                        <button class="page-btn" onclick="changePage(-1)">‚Üê –ù–∞–∑–∞–¥</button>
                        <span class="page-info" id="pageInfo">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1</span>
                        <button class="page-btn" onclick="changePage(1)">–í–ø–µ—Ä—ë–¥ ‚Üí</button>
                    </div>
                </div>

                <!-- Stats Section -->
                <div id="stats" class="section">
                    <h2 class="card-title">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalWorkouts">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalVolume">0</div>
                            <div class="stat-label">–û–±—â–∏–π –æ–±—ä—ë–º, –∫–≥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgWorkoutTime">0</div>
                            <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è, –º–∏–Ω</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="successRate">0%</div>
                            <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ü–µ–ª–µ–π</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º</h3>
                        <div id="exerciseStats"></div>
                    </div>
                </div>
            </div>

            <!-- New Workout Section -->
            <div id="new-workout" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‚ûï –ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
                        <button class="btn btn-icon btn-secondary" onclick="showSection('programs')">
                            üìã
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</label>
                        <input type="text" class="form-input" id="workoutName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≥—Ä—É–¥–∏">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üìã –ü—Ä–æ–≥—Ä–∞–º–º–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <select class="form-input" id="workoutProgram" onchange="loadProgramExercises()">
                            <option value="">–ë–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã</option>
                        </select>
                    </div>
                    
                    <div id="exercisesContainer">
                        <div class="form-group">
                            <label class="form-label">üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</label>
                            <div class="exercise-item">
                                <div class="exercise-info">
                                    <div class="exercise-name">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="addExerciseField()">
                        <span>‚ûï</span>
                        <span>–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</span>
                    </button>
                    
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="saveWorkout()">
                            <span>üíæ</span>
                            <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</span>
                        </button>
                        <button class="btn btn-secondary" onclick="showSection('home')">
                            <span>‚Üê</span>
                            <span>–ù–∞–∑–∞–¥</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Custom Workout Section -->
            <div id="custom-workout" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‚úèÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</label>
                        <input type="text" class="form-input" id="programName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –§—É–ª–±–æ–¥–∏ 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üìù –û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-input" id="programDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üìÖ –î–Ω–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</label>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 4px;">
                                <input type="checkbox" name="workoutDays" value="1"> –ü–Ω
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px;">
                                <input type="checkbox" name="workoutDays" value="2"> –í—Ç
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px;">
                                <input type="checkbox" name="workoutDays" value="3"> –°—Ä
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px;">
                                <input type="checkbox" name="workoutDays" value="4"> –ß—Ç
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px;">
                                <input type="checkbox" name="workoutDays" value="5"> –ü—Ç
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px;">
                                <input type="checkbox" name="workoutDays" value="6"> –°–±
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px;">
                                <input type="checkbox" name="workoutDays" value="0"> –í—Å
                            </label>
                        </div>
                    </div>
                    
                    <div id="programExercisesContainer">
                        <div class="exercise-item">
                            <div class="exercise-info">
                                <input type="text" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è" style="margin-bottom: 8px;">
                                <div class="form-row">
                                    <input type="number" class="form-input" placeholder="–ü–æ–¥—Ö–æ–¥—ã">
                                    <input type="number" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è">
                                    <input type="number" class="form-input" placeholder="–í–µ—Å, –∫–≥">
                                </div>
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="removeExerciseField(this)">üóëÔ∏è</button>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="addProgramExerciseField()">
                        <span>‚ûï</span>
                        <span>–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</span>
                    </button>
                    
                    <div class="form-actions">
                        <button class="btn btn-success" onclick="saveCustomProgram()">
                            <span>üíæ</span>
                            <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É</span>
                        </button>
                        <button class="btn btn-secondary" onclick="showSection('programs')">
                            <span>‚Üê</span>
                            <span>–ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="app-footer">
            <div>
                üí™ Fitness Pro v2.0
            </div>
            <button class="btn start-workout-btn" onclick="startQuickWorkout()">
                ‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            </button>
        </footer>
    </div>

    <script>
        // ========== GLOBAL VARIABLES ==========
        const tg = window.Telegram?.WebApp;
        let db;
        let currentPage = 1;
        const itemsPerPage = 5;
        let timerInterval = null;
        let timerSeconds = 0;
        let isTimerRunning = false;

        // Predefined workout programs
        const predefinedPrograms = [
            {
                id: 1,
                name: "üí™ –ù–∞—á–∞–ª—å–Ω–∞—è —Å–∏–ª–∞",
                description: "–ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤",
                exercises: [
                    { name: "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è", sets: 3, reps: 5, weight: 0 },
                    { name: "–ñ–∏–º –ª—ë–∂–∞", sets: 3, reps: 5, weight: 0 },
                    { name: "–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞", sets: 1, reps: 5, weight: 0 }
                ],
                days: [1, 3, 5]
            },
            {
                id: 2,
                name: "üî∫ –ü–ª–µ—á–∏ –∏ —Ä—É–∫–∏",
                description: "–ò–∑–æ–ª—è—Ü–∏—è –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Ç–µ–ª–∞",
                exercises: [
                    { name: "–ñ–∏–º —à—Ç–∞–Ω–≥–∏ —Å—Ç–æ—è", sets: 4, reps: 8, weight: 0 },
                    { name: "–ú–∞—Ö–∏ –≥–∞–Ω—Ç–µ–ª–µ–π", sets: 3, reps: 12, weight: 0 },
                    { name: "–ü–æ–¥—ä—ë–º –Ω–∞ –±–∏—Ü–µ–ø—Å", sets: 3, reps: 10, weight: 0 },
                    { name: "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º", sets: 3, reps: 10, weight: 0 }
                ],
                days: [2, 4]
            },
            {
                id: 3,
                name: "üèÉ –ö–∞—Ä–¥–∏–æ + –ü—Ä–µ—Å—Å",
                description: "–î–ª—è –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏ –∏ —Ä–µ–ª—å–µ—Ñ–∞",
                exercises: [
                    { name: "–ë–µ–≥–æ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞", sets: 1, reps: 20, weight: 0 },
                    { name: "–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è", sets: 3, reps: 15, weight: 0 },
                    { name: "–ü–ª–∞–Ω–∫–∞", sets: 3, reps: 60, weight: 0 },
                    { name: "–í–µ–ª–æ—Ç—Ä–µ–Ω–∞–∂—ë—Ä", sets: 1, reps: 15, weight: 0 }
                ],
                days: [0, 3, 6]
            },
            {
                id: 4,
                name: "ü¶µ –î–µ–Ω—å –Ω–æ–≥",
                description: "–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–æ–≥",
                exercises: [
                    { name: "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π", sets: 4, reps: 8, weight: 0 },
                    { name: "–ú—ë—Ä—Ç–≤–∞—è —Ç—è–≥–∞", sets: 3, reps: 8, weight: 0 },
                    { name: "–ñ–∏–º –Ω–æ–≥–∞–º–∏", sets: 3, reps: 10, weight: 0 },
                    { name: "–í—ã–ø–∞–¥—ã", sets: 3, reps: 12, weight: 0 }
                ],
                days: [1, 4]
            }
        ];

        // ========== INITIALIZATION ==========
        window.addEventListener('load', async () => {
            if (tg) {
                tg.ready();
                tg.expand();
                tg.enableClosingConfirmation();
            }

            await initDB();
            updateCurrentDate();
            loadPrograms();
            loadProgramsSelect();
            loadHistory();
            updateStats();
            updateQuickStart();
        });

        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('ru-RU', options);
        }

        // ========== INDEXEDDB ==========
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('FitnessProDB', 2);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve();
                };

                request.onupgradeneeded = (event) => {
                    const database = event.target.result;

                    if (!database.objectStoreNames.contains('workouts')) {
                        database.createObjectStore('workouts', { keyPath: 'id', autoIncrement: true });
                    }
                    if (!database.objectStoreNames.contains('programs')) {
                        database.createObjectStore('programs', { keyPath: 'id', autoIncrement: true });
                    }
                    if (!database.objectStoreNames.contains('history')) {
                        database.createObjectStore('history', { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        // ========== UI FUNCTIONS ==========
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });

            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'flex';
            }

            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Update active tab in home section
            if (['quick-start', 'programs', 'history', 'stats'].includes(sectionId)) {
                const tab = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
                if (tab) tab.classList.add('active');
                document.getElementById('home').classList.add('active');
                document.getElementById('home').style.display = 'flex';
            }
        }

        function showMessage(text, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            messageDiv.innerHTML = `
                <span>${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
                <span>${text}</span>
            `;

            const content = document.querySelector('.content');
            content.insertBefore(messageDiv, content.firstChild);

            setTimeout(() => messageDiv.remove(), 3000);
        }

        // ========== WORKOUT FUNCTIONS ==========
        function addExerciseField() {
            const container = document.getElementById('exercisesContainer');
            const exerciseCount = container.querySelectorAll('.exercise-item').length + 1;

            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'exercise-item';
            exerciseDiv.innerHTML = `
                <div class="exercise-info" style="flex: 1;">
                    <input type="text" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è" 
                           style="margin-bottom: 8px;" id="exerciseName${exerciseCount}">
                    <div class="form-row">
                        <input type="number" class="form-input" placeholder="–ü–æ–¥—Ö–æ–¥—ã" 
                               id="exerciseSets${exerciseCount}" min="1" value="3">
                        <input type="number" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è" 
                               id="exerciseReps${exerciseCount}" min="1" value="10">
                        <input type="number" class="form-input" placeholder="–í–µ—Å, –∫–≥" 
                               id="exerciseWeight${exerciseCount}" min="0" step="0.5" value="0">
                    </div>
                </div>
                <button class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">üóëÔ∏è</button>
            `;

            container.appendChild(exerciseDiv);
        }

        async function saveWorkout() {
            const workoutName = document.getElementById('workoutName').value;
            const programId = document.getElementById('workoutProgram').value;

            if (!workoutName) {
                showMessage('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏', 'error');
                return;
            }

            const exercises = [];
            const exerciseItems = document.querySelectorAll('#exercisesContainer .exercise-item');

            if (exerciseItems.length === 0) {
                showMessage('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', 'error');
                return;
            }

            exerciseItems.forEach((item, index) => {
                const name = item.querySelector(`#exerciseName${index + 1}`)?.value || 
                            item.querySelector('input[placeholder*="–ù–∞–∑–≤–∞–Ω–∏–µ"]')?.value;
                const sets = parseInt(item.querySelector(`#exerciseSets${index + 1}`)?.value || 
                            item.querySelector('input[placeholder*="–ü–æ–¥—Ö–æ–¥—ã"]')?.value) || 0;
                const reps = parseInt(item.querySelector(`#exerciseReps${index + 1}`)?.value || 
                            item.querySelector('input[placeholder*="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è"]')?.value) || 0;
                const weight = parseFloat(item.querySelector(`#exerciseWeight${index + 1}`)?.value || 
                            item.querySelector('input[placeholder*="–í–µ—Å"]')?.value) || 0;

                if (name && sets > 0 && reps > 0) {
                    exercises.push({
                        name,
                        sets,
                        reps,
                        weight,
                        volume: weight * reps * sets
                    });
                }
            });

            if (exercises.length === 0) {
                showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π', 'error');
                return;
            }

            const totalVolume = exercises.reduce((sum, ex) => sum + ex.volume, 0);

            const workoutData = {
                name: workoutName,
                programId: programId || null,
                exercises: exercises,
                totalVolume: totalVolume,
                date: new Date().toISOString(),
                timestamp: Date.now()
            };

            try {
                const transaction = db.transaction(['workouts', 'history'], 'readwrite');
                const workoutStore = transaction.objectStore('workouts');
                const historyStore = transaction.objectStore('history');

                const workoutRequest = workoutStore.add(workoutData);
                const historyRequest = historyStore.add({
                    ...workoutData,
                    completedAt: new Date().toLocaleString('ru-RU')
                });

                await Promise.all([workoutRequest, historyRequest]);

                showMessage('‚úÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                
                // Clear form
                document.getElementById('workoutName').value = '';
                document.getElementById('exercisesContainer').innerHTML = `
                    <div class="form-group">
                        <label class="form-label">üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</label>
                        <div class="exercise-item">
                            <div class="exercise-info">
                                <div class="exercise-name">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</div>
                            </div>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    showSection('home');
                    updateStats();
                    loadHistory();
                }, 1500);
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏', 'error');
                console.error(error);
            }
        }

        // ========== PROGRAM FUNCTIONS ==========
        function loadPrograms() {
            const container = document.getElementById('programsList');
            container.innerHTML = '';

            // Add predefined programs
            predefinedPrograms.forEach(program => {
                const programDiv = document.createElement('div');
                programDiv.className = 'program-card';
                programDiv.onclick = () => selectProgram(program);
                programDiv.innerHTML = `
                    <div class="program-icon">${program.name.charAt(0)}</div>
                    <div class="program-title">${program.name}</div>
                    <div class="program-exercises">${program.exercises.length} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                    <div style="font-size: 0.8em; color: var(--text-secondary);">
                        ${program.days.map(d => ['–í—Å','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'][d]).join(', ')}
                    </div>
                `;
                container.appendChild(programDiv);
            });

            // Load custom programs from DB
            const transaction = db.transaction(['programs'], 'readonly');
            const store = transaction.objectStore('programs');
            const request = store.getAll();

            request.onsuccess = () => {
                request.result.forEach(program => {
                    const programDiv = document.createElement('div');
                    programDiv.className = 'program-card';
                    programDiv.onclick = () => selectProgram(program);
                    programDiv.innerHTML = `
                        <div class="program-icon">üìù</div>
                        <div class="program-title">${program.name}</div>
                        <div class="program-exercises">${program.exercises.length} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                        <div style="font-size: 0.8em; color: var(--text-secondary);">
                            ${program.days ? program.days.map(d => ['–í—Å','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'][d]).join(', ') : '–ü–æ –≤—ã–±–æ—Ä—É'}
                        </div>
                    `;
                    container.appendChild(programDiv);
                });
            };
        }

        function loadProgramsSelect() {
            const select = document.getElementById('workoutProgram');
            select.innerHTML = '<option value="">–ë–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã</option>';

            predefinedPrograms.forEach(program => {
                const option = document.createElement('option');
                option.value = program.id;
                option.textContent = `${program.name} (${program.exercises.length} —É–ø—Ä.)`;
                select.appendChild(option);
            });

            // Load custom programs
            const transaction = db.transaction(['programs'], 'readonly');
            const store = transaction.objectStore('programs');
            const request = store.getAll();

            request.onsuccess = () => {
                request.result.forEach(program => {
                    const option = document.createElement('option');
                    option.value = 'custom_' + program.id;
                    option.textContent = `${program.name} (${program.exercises.length} —É–ø—Ä.)`;
                    select.appendChild(option);
                });
            };
        }

        function loadProgramExercises() {
            const programId = document.getElementById('workoutProgram').value;
            if (!programId) return;

            let program;
            
            if (programId.startsWith('custom_')) {
                const customId = parseInt(programId.replace('custom_', ''));
                // Load from DB
                const transaction = db.transaction(['programs'], 'readonly');
                const store = transaction.objectStore('programs');
                const request = store.get(customId);
                
                request.onsuccess = () => {
                    if (request.result) {
                        program = request.result;
                        displayProgramExercises(program);
                    }
                };
            } else {
                program = predefinedPrograms.find(p => p.id === parseInt(programId));
                if (program) {
                    displayProgramExercises(program);
                }
            }
        }

        function displayProgramExercises(program) {
            const container = document.getElementById('exercisesContainer');
            container.innerHTML = '<div class="form-group"><label class="form-label">üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã</label></div>';

            program.exercises.forEach((exercise, index) => {
                const exerciseDiv = document.createElement('div');
                exerciseDiv.className = 'exercise-item';
                exerciseDiv.innerHTML = `
                    <div class="exercise-info" style="flex: 1;">
                        <input type="text" class="form-input" 
                               value="${exercise.name}" 
                               style="margin-bottom: 8px;" 
                               id="programExerciseName${index + 1}">
                        <div class="form-row">
                            <input type="number" class="form-input" value="${exercise.sets}" 
                                   id="programExerciseSets${index + 1}" min="1">
                            <input type="number" class="form-input" value="${exercise.reps}" 
                                   id="programExerciseReps${index + 1}" min="1">
                            <input type="number" class="form-input" placeholder="–í–µ—Å, –∫–≥" 
                                   id="programExerciseWeight${index + 1}" min="0" step="0.5">
                        </div>
                    </div>
                `;
                container.appendChild(exerciseDiv);
            });
        }

        function selectProgram(program) {
            showSection('new-workout');
            document.getElementById('workoutName').value = program.name;
            
            // Simulate selecting in dropdown
            const select = document.getElementById('workoutProgram');
            const option = Array.from(select.options).find(opt => 
                opt.value === program.id.toString() || 
                opt.value === 'custom_' + program.id
            );
            if (option) {
                select.value = option.value;
                loadProgramExercises();
            }
        }

        // ========== CUSTOM PROGRAM FUNCTIONS ==========
        function addProgramExerciseField() {
            const container = document.getElementById('programExercisesContainer');
            
            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'exercise-item';
            exerciseDiv.innerHTML = `
                <div class="exercise-info">
                    <input type="text" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è" style="margin-bottom: 8px;">
                    <div class="form-row">
                        <input type="number" class="form-input" placeholder="–ü–æ–¥—Ö–æ–¥—ã" value="3">
                        <input type="number" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è" value="10">
                        <input type="number" class="form-input" placeholder="–í–µ—Å, –∫–≥" value="0">
                    </div>
                </div>
                <button class="btn btn-danger btn-sm" onclick="removeExerciseField(this)">üóëÔ∏è</button>
            `;
            
            container.appendChild(exerciseDiv);
        }

        function removeExerciseField(button) {
            button.parentElement.remove();
        }

        async function saveCustomProgram() {
            const name = document.getElementById('programName').value;
            const description = document.getElementById('programDescription').value;
            
            if (!name) {
                showMessage('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã', 'error');
                return;
            }

            // Get selected days
            const dayCheckboxes = document.querySelectorAll('input[name="workoutDays"]:checked');
            const days = Array.from(dayCheckboxes).map(cb => parseInt(cb.value));

            // Get exercises
            const exercises = [];
            const exerciseItems = document.querySelectorAll('#programExercisesContainer .exercise-item');

            exerciseItems.forEach(item => {
                const inputs = item.querySelectorAll('input');
                if (inputs.length >= 4) {
                    exercises.push({
                        name: inputs[0].value || '–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ',
                        sets: parseInt(inputs[1].value) || 3,
                        reps: parseInt(inputs[2].value) || 10,
                        weight: parseFloat(inputs[3].value) || 0
                    });
                }
            });

            if (exercises.length === 0) {
                showMessage('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', 'error');
                return;
            }

            const programData = {
                name,
                description,
                days,
                exercises,
                createdAt: new Date().toISOString(),
                isCustom: true
            };

            try {
                const transaction = db.transaction(['programs'], 'readwrite');
                const store = transaction.objectStore('programs');
                await store.add(programData);

                showMessage('‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                
                // Clear form
                document.getElementById('programName').value = '';
                document.getElementById('programDescription').value = '';
                document.querySelectorAll('input[name="workoutDays"]').forEach(cb => cb.checked = false);
                document.getElementById('programExercisesContainer').innerHTML = `
                    <div class="exercise-item">
                        <div class="exercise-info">
                            <input type="text" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è" style="margin-bottom: 8px;">
                            <div class="form-row">
                                <input type="number" class="form-input" placeholder="–ü–æ–¥—Ö–æ–¥—ã">
                                <input type="number" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è">
                                <input type="number" class="form-input" placeholder="–í–µ—Å, –∫–≥">
                            </div>
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="removeExerciseField(this)">üóëÔ∏è</button>
                    </div>
                `;

                setTimeout(() => {
                    showSection('programs');
                    loadPrograms();
                    loadProgramsSelect();
                }, 1500);
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏', 'error');
                console.error(error);
            }
        }

        // ========== HISTORY FUNCTIONS ==========
        async function loadHistory() {
            const filter = document.getElementById('historyFilter').value;
            const sort = document.getElementById('historySort').value;
            
            const workouts = await getAllWorkouts();
            
            // Apply filters
            let filteredWorkouts = workouts;
            const now = new Date();
            
            if (filter === 'week') {
                const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
                filteredWorkouts = workouts.filter(w => new Date(w.date) >= weekAgo);
            } else if (filter === 'month') {
                const monthAgo = new Date(now - 30 * 24 * 60 * 60 * 1000);
                filteredWorkouts = workouts.filter(w => new Date(w.date) >= monthAgo);
            } else if (filter === 'year') {
                const yearAgo = new Date(now - 365 * 24 * 60 * 60 * 1000);
                filteredWorkouts = workouts.filter(w => new Date(w.date) >= yearAgo);
            }
            
            // Apply sorting
            if (sort === 'oldest') {
                filteredWorkouts.sort((a, b) => new Date(a.date) - new Date(b.date));
            } else if (sort === 'volume') {
                filteredWorkouts.sort((a, b) => b.totalVolume - a.totalVolume);
            } else {
                filteredWorkouts.sort((a, b) => new Date(b.date) - new Date(a.date));
            }
            
            displayHistoryPage(filteredWorkouts, currentPage);
        }

        async function getAllWorkouts() {
            return new Promise((resolve) => {
                const transaction = db.transaction(['history'], 'readonly');
                const store = transaction.objectStore('history');
                const request = store.getAll();

                request.onsuccess = () => {
                    resolve(request.result);
                };
            });
        }

        function displayHistoryPage(workouts, page) {
            const container = document.getElementById('historyContainer');
            const pagination = document.getElementById('historyPagination');
            
            if (workouts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <div class="empty-state-title">–ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                        <p>–ù–∞—á–Ω–∏—Ç–µ —Å –ø–µ—Ä–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!</p>
                        <button class="btn btn-primary" onclick="showSection('new-workout')" 
                                style="margin-top: 16px;">
                            –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                        </button>
                    </div>
                `;
                pagination.style.display = 'none';
                return;
            }
            
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageWorkouts = workouts.slice(start, end);
            const totalPages = Math.ceil(workouts.length / itemsPerPage);
            
            container.innerHTML = pageWorkouts.map(workout => `
                <div class="card" style="margin-bottom: 16px;">
                    <div class="card-header">
                        <h3 class="card-title">${workout.name}</h3>
                        <span style="font-size: 0.9em; color: var(--text-secondary);">
                            ${workout.completedAt || new Date(workout.date).toLocaleDateString('ru-RU')}
                        </span>
                    </div>
                    
                    <div style="margin: 12px 0;">
                        <strong>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (${workout.exercises.length}):</strong>
                        <div style="margin-top: 8px;">
                            ${workout.exercises.map(ex => `
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; 
                                            border-bottom: 1px solid var(--border);">
                                    <span>${ex.name}</span>
                                    <span style="color: var(--primary);">
                                        ${ex.sets}√ó${ex.reps} ${ex.weight > 0 ? `@ ${ex.weight}–∫–≥` : ''}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; 
                                background: var(--surface-dark); padding: 12px; border-radius: var(--radius-sm);">
                        <div>
                            <div style="font-size: 0.9em; color: var(--text-secondary);">–û–±—â–∏–π –æ–±—ä—ë–º</div>
                            <div style="font-weight: 700; color: var(--primary);">
                                ${workout.totalVolume.toLocaleString()} –∫–≥
                            </div>
                        </div>
                        <button class="btn btn-danger btn-sm" 
                                onclick="deleteWorkout(${workout.id})">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Update pagination
            if (totalPages > 1) {
                pagination.style.display = 'flex';
                document.getElementById('pageInfo').textContent = 
                    `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${page} –∏–∑ ${totalPages}`;
                
                const prevBtn = pagination.querySelector('.page-btn:first-child');
                const nextBtn = pagination.querySelector('.page-btn:last-child');
                
                prevBtn.disabled = page === 1;
                nextBtn.disabled = page === totalPages;
            } else {
                pagination.style.display = 'none';
            }
        }

        function changePage(delta) {
            currentPage += delta;
            loadHistory();
        }

        async function deleteWorkout(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?')) return;
            
            try {
                const transaction = db.transaction(['history'], 'readwrite');
                const store = transaction.objectStore('history');
                await store.delete(id);
                
                showMessage('üóëÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
                loadHistory();
                updateStats();
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏', 'error');
            }
        }

        // ========== STATISTICS FUNCTIONS ==========
        async function updateStats() {
            const workouts = await getAllWorkouts();
            
            document.getElementById('totalWorkouts').textContent = workouts.length;
            
            const totalVolume = workouts.reduce((sum, w) => sum + (w.totalVolume || 0), 0);
            document.getElementById('totalVolume').textContent = totalVolume.toLocaleString();
            
            // Calculate average workout time (mock)
            const avgTime = workouts.length > 0 ? Math.round(45 + Math.random() * 30) : 0;
            document.getElementById('avgWorkoutTime').textContent = avgTime;
            
            // Calculate success rate
            const successRate = workouts.length > 0 ? 
                Math.round((workouts.filter(w => w.totalVolume > 1000).length / workouts.length) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            // Update exercise stats
            updateExerciseStats(workouts);
        }

        function updateExerciseStats(workouts) {
            const exerciseStats = {};
            
            workouts.forEach(workout => {
                workout.exercises.forEach(ex => {
                    if (!exerciseStats[ex.name]) {
                        exerciseStats[ex.name] = {
                            count: 0,
                            maxWeight: 0,
                            totalVolume: 0
                        };
                    }
                    
                    exerciseStats[ex.name].count++;
                    exerciseStats[ex.name].maxWeight = Math.max(exerciseStats[ex.name].maxWeight, ex.weight);
                    exerciseStats[ex.name].totalVolume += ex.volume || 0;
                });
            });
            
            const container = document.getElementById('exerciseStats');
            const topExercises = Object.entries(exerciseStats)
                .sort((a, b) => b[1].totalVolume - a[1].totalVolume)
                .slice(0, 5);
            
            if (topExercises.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }
            
            container.innerHTML = topExercises.map(([name, stats]) => `
                <div style="margin-bottom: 12px; padding: 12px; background: var(--bg); 
                            border-radius: var(--radius-sm);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <strong>${name}</strong>
                        <span style="color: var(--primary); font-weight: 600;">
                            ${stats.totalVolume.toLocaleString()} –∫–≥
                        </span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.9em; 
                                color: var(--text-secondary);">
                        <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${stats.count} —Ä–∞–∑</span>
                        <span>–ú–∞–∫—Å. –≤–µ—Å: ${stats.maxWeight} –∫–≥</span>
                    </div>
                </div>
            `).join('');
        }

        // ========== QUICK START FUNCTIONS ==========
        async function updateQuickStart() {
            const workouts = await getAllWorkouts();
            const today = new Date().toDateString();
            const todayWorkouts = workouts.filter(w => 
                new Date(w.date).toDateString() === today
            );
            
            // Update workout streak
            let streak = 0;
            const sortedWorkouts = workouts.sort((a, b) => new Date(b.date) - new Date(a.date));
            let lastDate = new Date();
            
            for (const workout of sortedWorkouts) {
                const workoutDate = new Date(workout.date);
                const diffDays = Math.floor((lastDate - workoutDate) / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    lastDate = workoutDate;
                    continue;
                } else if (diffDays === 1) {
                    streak++;
                    lastDate = workoutDate;
                } else {
                    break;
                }
            }
            
            document.getElementById('workoutStreak').textContent = streak;
            
            // Update active programs count
            const programs = await getAllPrograms();
            const activePrograms = programs.filter(p => 
                p.days && p.days.includes(new Date().getDay())
            ).length;
            
            document.getElementById('activeProgramCount').textContent = activePrograms;
            
            // Update today's goal
            const goalElement = document.getElementById('todayGoal');
            const progressElement = document.getElementById('goalProgress');
            
            if (todayWorkouts.length > 0) {
                goalElement.textContent = `–°–µ–≥–æ–¥–Ω—è –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${todayWorkouts.length} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞`;
                progressElement.style.width = '100%';
            } else if (activePrograms > 0) {
                goalElement.textContent = '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞';
                progressElement.style.width = '30%';
            } else {
                goalElement.textContent = '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º –Ω–∞ —Å–µ–≥–æ–¥–Ω—è';
                progressElement.style.width = '0%';
            }
        }

        async function getAllPrograms() {
            return new Promise((resolve) => {
                const transaction = db.transaction(['programs'], 'readonly');
                const store = transaction.objectStore('programs');
                const request = store.getAll();

                request.onsuccess = () => {
                    const customPrograms = request.result;
                    const allPrograms = [...predefinedPrograms, ...customPrograms];
                    resolve(allPrograms);
                };
            });
        }

        // ========== TIMER FUNCTIONS ==========
        function toggleTimer() {
            const timerSection = document.getElementById('timer-section');
            const isVisible = timerSection.style.display !== 'none';
            
            if (isVisible) {
                timerSection.style.display = 'none';
                showSection('quick-start');
            } else {
                document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
                timerSection.style.display = 'flex';
                timerSection.classList.add('active');
            }
        }

        function startTimer() {
            if (!isTimerRunning) {
                isTimerRunning = true;
                timerInterval = setInterval(() => {
                    timerSeconds++;
                    updateTimerDisplay();
                }, 1000);
            }
        }

        function pauseTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
        }

        function resetTimer() {
            pauseTimer();
            timerSeconds = 0;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ========== QUICK WORKOUT START ==========
        function startQuickWorkout() {
            showSection('new-workout');
            document.getElementById('workoutName').value = '–ë—ã—Å—Ç—Ä–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ' + 
                new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'});
            
            // Add some default exercises
            addExerciseField();
        }
    </script>
</body>
</html>
